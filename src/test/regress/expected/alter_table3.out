drop table if exists t1;
NOTICE:  table "t1" does not exist, skipping
drop table if exists t100;
NOTICE:  table "t100" does not exist, skipping
drop table if exists t101;
NOTICE:  table "t101" does not exist, skipping
drop table if exists t102;
NOTICE:  table "t102" does not exist, skipping
drop table if exists t103;
NOTICE:  table "t103" does not exist, skipping
drop table if exists t30;
NOTICE:  table "t30" does not exist, skipping
drop table if exists t301;
drop table if exists t302;
drop table if exists t303;
drop table if exists t304;
create table t1(a serial primary key, b int) partition by hash(a);
create table t100 partition of t1 for values with (modulus 4, remainder 0);
create table t101 partition of t1 for values with (modulus 4, remainder 1);
create table t102 partition of t1 for values with (modulus 4, remainder 2);
create table t103 partition of t1 for values with (modulus 4, remainder 3);
insert into t1(b) values(11),(22),(33);
alter table t1 add column c int not null;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           | not null |                                 | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t1;
 a | b  | c 
---+----+---
 1 | 11 | 0
 3 | 33 | 0
 2 | 22 | 0
(3 rows)

alter table t1 drop column c;
select*from t1;
 a | b  
---+----
 1 | 11
 3 | 33
 2 | 22
(3 rows)

insert into t1(b) values(11),(22),(33), (11),(22),(33), (11),(22),(33), (11),(22),(33);
alter table t1 add column c int;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          |                                 | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t1;
 a  | b  | c 
----+----+---
  1 | 11 |  
 12 | 33 |  
 14 | 22 |  
  3 | 33 |  
  5 | 22 |  
  8 | 22 |  
  9 | 33 |  
 11 | 22 |  
  2 | 22 |  
 13 | 11 |  
  4 | 11 |  
  6 | 33 |  
  7 | 11 |  
 10 | 11 |  
 15 | 33 |  
(15 rows)

alter table t1 alter column c set default 123;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          | 123                             | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(44);
insert into t1(b,c) values(44, 45);
select*from t1;
 a  | b  |  c  
----+----+-----
  1 | 11 |    
 12 | 33 |    
 14 | 22 |    
 16 | 44 | 123
 17 | 44 |  45
  3 | 33 |    
  5 | 22 |    
  8 | 22 |    
  9 | 33 |    
 11 | 22 |    
  2 | 22 |    
 13 | 11 |    
  4 | 11 |    
  6 | 33 |    
  7 | 11 |    
 10 | 11 |    
 15 | 33 |    
(17 rows)

alter table t1 alter column c drop default;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          |                                 | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(55);
select*from t1;
 a  | b  |  c  
----+----+-----
  1 | 11 |    
 12 | 33 |    
 14 | 22 |    
 16 | 44 | 123
 17 | 44 |  45
  3 | 33 |    
  5 | 22 |    
  8 | 22 |    
  9 | 33 |    
 11 | 22 |    
  2 | 22 |    
 13 | 11 |    
 18 | 55 |    
  4 | 11 |    
  6 | 33 |    
  7 | 11 |    
 10 | 11 |    
 15 | 33 |    
(18 rows)

alter table t1 drop column c;
alter table t1 add column c int default 123456789;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(18 rows)

alter table t1 alter column c smallint not null;
ERROR:  syntax error at or near "smallint"
LINE 1: alter table t1 alter column c smallint not null;
                                      ^
alter table t1 alter column c type smallint;
ERROR:  Kunlun-db: MySQL storage node (1, 1) returned error: 1264, Out of range value for column 'c' at row 1.
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

alter table t1 alter column c type int not null;
ERROR:  syntax error at or near "not"
LINE 1: alter table t1 alter column c type int not null;
                                               ^
alter table t1 alter column c set not null;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           | not null | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(66);
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(19 rows)

\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           | not null | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

alter table t1 alter column c drop not null;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           |          | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(66);
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
 20 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(20 rows)

alter table t1 alter column c set not null;
\d+ t1;
                                                Table "public.t1"
 Column |  Type   | Collation | Nullable |             Default             | Storage | Stats target | Description 
--------+---------+-----------+----------+---------------------------------+---------+--------------+-------------
 a      | integer |           | not null | "nextval"('t1_a_seq'::regclass) | plain   |              | 
 b      | integer |           |          |                                 | plain   |              | 
 c      | integer |           | not null | 123456789                       | plain   |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(66);
select*from t1;
 a  | b  |     c     
----+----+-----------
  1 | 11 | 123456789
 12 | 33 | 123456789
 14 | 22 | 123456789
 16 | 44 | 123456789
 17 | 44 | 123456789
  3 | 33 | 123456789
  5 | 22 | 123456789
  8 | 22 | 123456789
  9 | 33 | 123456789
 11 | 22 | 123456789
 19 | 66 | 123456789
 20 | 66 | 123456789
 21 | 66 | 123456789
  2 | 22 | 123456789
 13 | 11 | 123456789
 18 | 55 | 123456789
  4 | 11 | 123456789
  6 | 33 | 123456789
  7 | 11 | 123456789
 10 | 11 | 123456789
 15 | 33 | 123456789
(21 rows)

alter table t1 add column d varchar(32) not null;
alter table t1 add column d varchar(32);
ERROR:  column "d" of relation "t1" already exists
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character varying(32) |           | not null |                                 | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*, d is null as disnull, length(d) from t1;
 a  | b  |     c     | d | disnull | length 
----+----+-----------+---+---------+--------
  1 | 11 | 123456789 |   | f       |      0
 12 | 33 | 123456789 |   | f       |      0
 14 | 22 | 123456789 |   | f       |      0
 16 | 44 | 123456789 |   | f       |      0
 17 | 44 | 123456789 |   | f       |      0
  3 | 33 | 123456789 |   | f       |      0
  5 | 22 | 123456789 |   | f       |      0
  8 | 22 | 123456789 |   | f       |      0
  9 | 33 | 123456789 |   | f       |      0
 11 | 22 | 123456789 |   | f       |      0
 19 | 66 | 123456789 |   | f       |      0
 20 | 66 | 123456789 |   | f       |      0
 21 | 66 | 123456789 |   | f       |      0
  2 | 22 | 123456789 |   | f       |      0
 13 | 11 | 123456789 |   | f       |      0
 18 | 55 | 123456789 |   | f       |      0
  4 | 11 | 123456789 |   | f       |      0
  6 | 33 | 123456789 |   | f       |      0
  7 | 11 | 123456789 |   | f       |      0
 10 | 11 | 123456789 |   | f       |      0
 15 | 33 | 123456789 |   | f       |      0
(21 rows)

alter table t1 alter column d set default 'ddd';
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character varying(32) |           | not null | 'ddd'::character varying        | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(77);
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(22 rows)

alter table t1 alter column d drop default;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character varying(32) |           | not null |                                 | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(77);
ERROR:  Kunlun-db: MySQL storage node (2, 6) returned error: 1048, Column 'd' cannot be null.
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(22 rows)

alter table t1 alter column d set not null;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character varying(32) |           | not null |                                 | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(77);
ERROR:  Kunlun-db: MySQL storage node (1, 1) returned error: 1048, Column 'd' cannot be null.
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(22 rows)

alter table t1 alter column d drop not null;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character varying(32) |           |          |                                 | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1(b) values(77);
select*from t1;
 a  | b  |     c     |  d  
----+----+-----------+-----
  1 | 11 | 123456789 | 
 12 | 33 | 123456789 | 
 14 | 22 | 123456789 | 
 16 | 44 | 123456789 | 
 17 | 44 | 123456789 | 
  3 | 33 | 123456789 | 
  5 | 22 | 123456789 | 
  8 | 22 | 123456789 | 
  9 | 33 | 123456789 | 
 11 | 22 | 123456789 | 
 19 | 66 | 123456789 | 
 20 | 66 | 123456789 | 
 21 | 66 | 123456789 | 
  2 | 22 | 123456789 | 
 13 | 11 | 123456789 | 
 18 | 55 | 123456789 | 
 25 | 77 | 123456789 | 
  4 | 11 | 123456789 | 
  6 | 33 | 123456789 | 
  7 | 11 | 123456789 | 
 10 | 11 | 123456789 | 
 15 | 33 | 123456789 | 
 22 | 77 | 123456789 | ddd
(23 rows)

alter table t1 drop column d;
alter table t1 add column d varchar(32) default 'dddddddd';
select*from t1;
 a  | b  |     c     |    d     
----+----+-----------+----------
  1 | 11 | 123456789 | dddddddd
 12 | 33 | 123456789 | dddddddd
 14 | 22 | 123456789 | dddddddd
 16 | 44 | 123456789 | dddddddd
 17 | 44 | 123456789 | dddddddd
  3 | 33 | 123456789 | dddddddd
  5 | 22 | 123456789 | dddddddd
  8 | 22 | 123456789 | dddddddd
  9 | 33 | 123456789 | dddddddd
 11 | 22 | 123456789 | dddddddd
 19 | 66 | 123456789 | dddddddd
 20 | 66 | 123456789 | dddddddd
 21 | 66 | 123456789 | dddddddd
  2 | 22 | 123456789 | dddddddd
 13 | 11 | 123456789 | dddddddd
 18 | 55 | 123456789 | dddddddd
 25 | 77 | 123456789 | dddddddd
  4 | 11 | 123456789 | dddddddd
  6 | 33 | 123456789 | dddddddd
  7 | 11 | 123456789 | dddddddd
 10 | 11 | 123456789 | dddddddd
 15 | 33 | 123456789 | dddddddd
 22 | 77 | 123456789 | dddddddd
(23 rows)

alter table t1 alter column d type varchar(2) default 'd';
ERROR:  syntax error at or near "default"
LINE 1: alter table t1 alter column d type varchar(2) default 'd';
                                                      ^
alter table t1 alter column d type varchar(2);
ERROR:  Kunlun-db: MySQL storage node (1, 1) returned error: 1265, Data truncated for column 'd' at row 1.
alter table t1 alter column d type char(2) default 'd';
ERROR:  syntax error at or near "default"
LINE 1: alter table t1 alter column d type char(2) default 'd';
                                                   ^
alter table t1 alter column d type char(2);
ERROR:  Kunlun-db: MySQL storage node (2, 6) returned error: 1406, Data too long for column 'd' at row 1.
alter table t1 alter column d type char(32);
\d+ t1;
                                                    Table "public.t1"
 Column |     Type      | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+---------------+-----------+----------+---------------------------------+----------+--------------+-------------
 a      | integer       |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer       |           |          |                                 | plain    |              | 
 c      | integer       |           | not null | 123456789                       | plain    |              | 
 d      | character(32) |           |          | 'dddddddd'::character varying   | extended |              | 
Partition key: HASH (a)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (a)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1 (b) values(88);
select*from t1;
 a  | b  |     c     |                d                 
----+----+-----------+----------------------------------
  1 | 11 | 123456789 | dddddddd                        
 12 | 33 | 123456789 | dddddddd                        
 14 | 22 | 123456789 | dddddddd                        
 16 | 44 | 123456789 | dddddddd                        
 17 | 44 | 123456789 | dddddddd                        
 26 | 88 | 123456789 | dddddddd                        
  3 | 33 | 123456789 | dddddddd                        
  5 | 22 | 123456789 | dddddddd                        
  8 | 22 | 123456789 | dddddddd                        
  9 | 33 | 123456789 | dddddddd                        
 11 | 22 | 123456789 | dddddddd                        
 19 | 66 | 123456789 | dddddddd                        
 20 | 66 | 123456789 | dddddddd                        
 21 | 66 | 123456789 | dddddddd                        
  2 | 22 | 123456789 | dddddddd                        
 13 | 11 | 123456789 | dddddddd                        
 18 | 55 | 123456789 | dddddddd                        
 25 | 77 | 123456789 | dddddddd                        
  4 | 11 | 123456789 | dddddddd                        
  6 | 33 | 123456789 | dddddddd                        
  7 | 11 | 123456789 | dddddddd                        
 10 | 11 | 123456789 | dddddddd                        
 15 | 33 | 123456789 | dddddddd                        
 22 | 77 | 123456789 | dddddddd                        
(24 rows)

alter table t1 add column e varchar(32) not null default 'abc';
select*from t1;
 a  | b  |     c     |                d                 |  e  
----+----+-----------+----------------------------------+-----
  1 | 11 | 123456789 | dddddddd                         | abc
 12 | 33 | 123456789 | dddddddd                         | abc
 14 | 22 | 123456789 | dddddddd                         | abc
 16 | 44 | 123456789 | dddddddd                         | abc
 17 | 44 | 123456789 | dddddddd                         | abc
 26 | 88 | 123456789 | dddddddd                         | abc
  3 | 33 | 123456789 | dddddddd                         | abc
  5 | 22 | 123456789 | dddddddd                         | abc
  8 | 22 | 123456789 | dddddddd                         | abc
  9 | 33 | 123456789 | dddddddd                         | abc
 11 | 22 | 123456789 | dddddddd                         | abc
 19 | 66 | 123456789 | dddddddd                         | abc
 20 | 66 | 123456789 | dddddddd                         | abc
 21 | 66 | 123456789 | dddddddd                         | abc
  2 | 22 | 123456789 | dddddddd                         | abc
 13 | 11 | 123456789 | dddddddd                         | abc
 18 | 55 | 123456789 | dddddddd                         | abc
 25 | 77 | 123456789 | dddddddd                         | abc
  4 | 11 | 123456789 | dddddddd                         | abc
  6 | 33 | 123456789 | dddddddd                         | abc
  7 | 11 | 123456789 | dddddddd                         | abc
 10 | 11 | 123456789 | dddddddd                         | abc
 15 | 33 | 123456789 | dddddddd                         | abc
 22 | 77 | 123456789 | dddddddd                         | abc
(24 rows)

alter table t1 rename c to cc, drop column c;
ERROR:  syntax error at or near ","
LINE 1: alter table t1 rename c to cc, drop column c;
                                     ^
alter table t1 rename c to cc, rename b to bb;
ERROR:  syntax error at or near ","
LINE 1: alter table t1 rename c to cc, rename b to bb;
                                     ^
alter table t1 rename a to aa;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | integer               |           |          |                                 | plain    |              | 
 c      | integer               |           | not null | 123456789                       | plain    |              | 
 d      | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

insert into t1 (b) values(99);
select*from t1;
 aa | b  |     c     |                d                 |  e  
----+----+-----------+----------------------------------+-----
  1 | 11 | 123456789 | dddddddd                         | abc
 12 | 33 | 123456789 | dddddddd                         | abc
 14 | 22 | 123456789 | dddddddd                         | abc
 16 | 44 | 123456789 | dddddddd                         | abc
 17 | 44 | 123456789 | dddddddd                         | abc
 26 | 88 | 123456789 | dddddddd                         | abc
  3 | 33 | 123456789 | dddddddd                         | abc
  5 | 22 | 123456789 | dddddddd                         | abc
  8 | 22 | 123456789 | dddddddd                         | abc
  9 | 33 | 123456789 | dddddddd                         | abc
 11 | 22 | 123456789 | dddddddd                         | abc
 19 | 66 | 123456789 | dddddddd                         | abc
 20 | 66 | 123456789 | dddddddd                         | abc
 21 | 66 | 123456789 | dddddddd                         | abc
  2 | 22 | 123456789 | dddddddd                         | abc
 13 | 11 | 123456789 | dddddddd                         | abc
 18 | 55 | 123456789 | dddddddd                         | abc
 25 | 77 | 123456789 | dddddddd                         | abc
 27 | 99 | 123456789 | dddddddd                         | abc
  4 | 11 | 123456789 | dddddddd                         | abc
  6 | 33 | 123456789 | dddddddd                         | abc
  7 | 11 | 123456789 | dddddddd                         | abc
 10 | 11 | 123456789 | dddddddd                         | abc
 15 | 33 | 123456789 | dddddddd                         | abc
 22 | 77 | 123456789 | dddddddd                         | abc
(25 rows)

alter table t1 drop column c, add column f int not null default 123, add column g serial not null, alter column b type bigint;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | bigint                |           |          |                                 | plain    |              | 
 d      | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 f      | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t1;
 aa | b  |                d                 |  e  |  f  | g 
----+----+----------------------------------+-----+-----+---
  1 | 11 | dddddddd                         | abc | 123 | 0
 12 | 33 | dddddddd                         | abc | 123 | 0
 14 | 22 | dddddddd                         | abc | 123 | 0
 16 | 44 | dddddddd                         | abc | 123 | 0
 17 | 44 | dddddddd                         | abc | 123 | 0
 26 | 88 | dddddddd                         | abc | 123 | 0
  3 | 33 | dddddddd                         | abc | 123 | 0
  5 | 22 | dddddddd                         | abc | 123 | 0
  8 | 22 | dddddddd                         | abc | 123 | 0
  9 | 33 | dddddddd                         | abc | 123 | 0
 11 | 22 | dddddddd                         | abc | 123 | 0
 19 | 66 | dddddddd                         | abc | 123 | 0
 20 | 66 | dddddddd                         | abc | 123 | 0
 21 | 66 | dddddddd                         | abc | 123 | 0
  2 | 22 | dddddddd                         | abc | 123 | 0
 13 | 11 | dddddddd                         | abc | 123 | 0
 18 | 55 | dddddddd                         | abc | 123 | 0
 25 | 77 | dddddddd                         | abc | 123 | 0
 27 | 99 | dddddddd                         | abc | 123 | 0
  4 | 11 | dddddddd                         | abc | 123 | 0
  6 | 33 | dddddddd                         | abc | 123 | 0
  7 | 11 | dddddddd                         | abc | 123 | 0
 10 | 11 | dddddddd                         | abc | 123 | 0
 15 | 33 | dddddddd                         | abc | 123 | 0
 22 | 77 | dddddddd                         | abc | 123 | 0
(25 rows)

insert into t1(f) values(333);
insert into t1(b) values(222);
select*from t1;
 aa |  b  |                d                 |  e  |  f  | g 
----+-----+----------------------------------+-----+-----+---
  1 |  11 | dddddddd                         | abc | 123 | 0
 12 |  33 | dddddddd                         | abc | 123 | 0
 14 |  22 | dddddddd                         | abc | 123 | 0
 16 |  44 | dddddddd                         | abc | 123 | 0
 17 |  44 | dddddddd                         | abc | 123 | 0
 26 |  88 | dddddddd                         | abc | 123 | 0
 28 |     | dddddddd                         | abc | 333 | 1
  3 |  33 | dddddddd                         | abc | 123 | 0
  5 |  22 | dddddddd                         | abc | 123 | 0
  8 |  22 | dddddddd                         | abc | 123 | 0
  9 |  33 | dddddddd                         | abc | 123 | 0
 11 |  22 | dddddddd                         | abc | 123 | 0
 19 |  66 | dddddddd                         | abc | 123 | 0
 20 |  66 | dddddddd                         | abc | 123 | 0
 21 |  66 | dddddddd                         | abc | 123 | 0
  2 |  22 | dddddddd                         | abc | 123 | 0
 13 |  11 | dddddddd                         | abc | 123 | 0
 18 |  55 | dddddddd                         | abc | 123 | 0
 25 |  77 | dddddddd                         | abc | 123 | 0
 27 |  99 | dddddddd                         | abc | 123 | 0
  4 |  11 | dddddddd                         | abc | 123 | 0
  6 |  33 | dddddddd                         | abc | 123 | 0
  7 |  11 | dddddddd                         | abc | 123 | 0
 10 |  11 | dddddddd                         | abc | 123 | 0
 15 |  33 | dddddddd                         | abc | 123 | 0
 22 |  77 | dddddddd                         | abc | 123 | 0
 29 | 222 | dddddddd                         | abc | 123 | 2
(27 rows)

alter table t1 rename f to ff;
alter table t1 rename d to dd;
\d+ t1;
                                                        Table "public.t1"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | bigint                |           |          |                                 | plain    |              | 
 dd     | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 ff     | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t1;
 aa |  b  |                dd                |  e  | ff  | g 
----+-----+----------------------------------+-----+-----+---
  1 |  11 | dddddddd                         | abc | 123 | 0
 12 |  33 | dddddddd                         | abc | 123 | 0
 14 |  22 | dddddddd                         | abc | 123 | 0
 16 |  44 | dddddddd                         | abc | 123 | 0
 17 |  44 | dddddddd                         | abc | 123 | 0
 26 |  88 | dddddddd                         | abc | 123 | 0
 28 |     | dddddddd                         | abc | 333 | 1
  3 |  33 | dddddddd                         | abc | 123 | 0
  5 |  22 | dddddddd                         | abc | 123 | 0
  8 |  22 | dddddddd                         | abc | 123 | 0
  9 |  33 | dddddddd                         | abc | 123 | 0
 11 |  22 | dddddddd                         | abc | 123 | 0
 19 |  66 | dddddddd                         | abc | 123 | 0
 20 |  66 | dddddddd                         | abc | 123 | 0
 21 |  66 | dddddddd                         | abc | 123 | 0
  2 |  22 | dddddddd                         | abc | 123 | 0
 13 |  11 | dddddddd                         | abc | 123 | 0
 18 |  55 | dddddddd                         | abc | 123 | 0
 25 |  77 | dddddddd                         | abc | 123 | 0
 27 |  99 | dddddddd                         | abc | 123 | 0
  4 |  11 | dddddddd                         | abc | 123 | 0
  6 |  33 | dddddddd                         | abc | 123 | 0
  7 |  11 | dddddddd                         | abc | 123 | 0
 10 |  11 | dddddddd                         | abc | 123 | 0
 15 |  33 | dddddddd                         | abc | 123 | 0
 22 |  77 | dddddddd                         | abc | 123 | 0
 29 | 222 | dddddddd                         | abc | 123 | 2
(27 rows)

alter table t1 rename to t11;
\d+ t1;
\d+ t11;
                                                       Table "public.t11"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 b      | bigint                |           |          |                                 | plain    |              | 
 dd     | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 ff     | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

alter table t11 rename b to bb;
\d+ t11;
                                                       Table "public.t11"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 bb     | bigint                |           |          |                                 | plain    |              | 
 dd     | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 ff     | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t11;
 aa | bb  |                dd                |  e  | ff  | g 
----+-----+----------------------------------+-----+-----+---
  1 |  11 | dddddddd                         | abc | 123 | 0
 12 |  33 | dddddddd                         | abc | 123 | 0
 14 |  22 | dddddddd                         | abc | 123 | 0
 16 |  44 | dddddddd                         | abc | 123 | 0
 17 |  44 | dddddddd                         | abc | 123 | 0
 26 |  88 | dddddddd                         | abc | 123 | 0
 28 |     | dddddddd                         | abc | 333 | 1
  3 |  33 | dddddddd                         | abc | 123 | 0
  5 |  22 | dddddddd                         | abc | 123 | 0
  8 |  22 | dddddddd                         | abc | 123 | 0
  9 |  33 | dddddddd                         | abc | 123 | 0
 11 |  22 | dddddddd                         | abc | 123 | 0
 19 |  66 | dddddddd                         | abc | 123 | 0
 20 |  66 | dddddddd                         | abc | 123 | 0
 21 |  66 | dddddddd                         | abc | 123 | 0
  2 |  22 | dddddddd                         | abc | 123 | 0
 13 |  11 | dddddddd                         | abc | 123 | 0
 18 |  55 | dddddddd                         | abc | 123 | 0
 25 |  77 | dddddddd                         | abc | 123 | 0
 27 |  99 | dddddddd                         | abc | 123 | 0
  4 |  11 | dddddddd                         | abc | 123 | 0
  6 |  33 | dddddddd                         | abc | 123 | 0
  7 |  11 | dddddddd                         | abc | 123 | 0
 10 |  11 | dddddddd                         | abc | 123 | 0
 15 |  33 | dddddddd                         | abc | 123 | 0
 22 |  77 | dddddddd                         | abc | 123 | 0
 29 | 222 | dddddddd                         | abc | 123 | 2
(27 rows)

create index t11_b on t11(bb);
\d+ t11;
                                                       Table "public.t11"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 bb     | bigint                |           |          |                                 | plain    |              | 
 dd     | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 ff     | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
    "t11_b" btree (bb)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

alter index t11_b rename to t11_bb;
\d+ t11;
                                                       Table "public.t11"
 Column |         Type          | Collation | Nullable |             Default             | Storage  | Stats target | Description 
--------+-----------------------+-----------+----------+---------------------------------+----------+--------------+-------------
 aa     | integer               |           | not null | "nextval"('t1_a_seq'::regclass) | plain    |              | 
 bb     | bigint                |           |          |                                 | plain    |              | 
 dd     | character(32)         |           |          | 'dddddddd'::character varying   | extended |              | 
 e      | character varying(32) |           | not null | 'abc'::character varying        | extended |              | 
 ff     | integer               |           | not null | 123                             | plain    |              | 
 g      | integer               |           | not null | "nextval"('t1_g_seq'::regclass) | plain    |              | 
Partition key: HASH (aa)
Indexes:
    "t1_pkey" PRIMARY KEY, btree (aa)
    "t11_bb" btree (bb)
Partitions: t100 FOR VALUES WITH (modulus 4, remainder 0),
            t101 FOR VALUES WITH (modulus 4, remainder 1),
            t102 FOR VALUES WITH (modulus 4, remainder 2),
            t103 FOR VALUES WITH (modulus 4, remainder 3)

select*from t11;
 aa | bb  |                dd                |  e  | ff  | g 
----+-----+----------------------------------+-----+-----+---
  1 |  11 | dddddddd                         | abc | 123 | 0
 12 |  33 | dddddddd                         | abc | 123 | 0
 14 |  22 | dddddddd                         | abc | 123 | 0
 16 |  44 | dddddddd                         | abc | 123 | 0
 17 |  44 | dddddddd                         | abc | 123 | 0
 26 |  88 | dddddddd                         | abc | 123 | 0
 28 |     | dddddddd                         | abc | 333 | 1
  3 |  33 | dddddddd                         | abc | 123 | 0
  5 |  22 | dddddddd                         | abc | 123 | 0
  8 |  22 | dddddddd                         | abc | 123 | 0
  9 |  33 | dddddddd                         | abc | 123 | 0
 11 |  22 | dddddddd                         | abc | 123 | 0
 19 |  66 | dddddddd                         | abc | 123 | 0
 20 |  66 | dddddddd                         | abc | 123 | 0
 21 |  66 | dddddddd                         | abc | 123 | 0
  2 |  22 | dddddddd                         | abc | 123 | 0
 13 |  11 | dddddddd                         | abc | 123 | 0
 18 |  55 | dddddddd                         | abc | 123 | 0
 25 |  77 | dddddddd                         | abc | 123 | 0
 27 |  99 | dddddddd                         | abc | 123 | 0
  4 |  11 | dddddddd                         | abc | 123 | 0
  6 |  33 | dddddddd                         | abc | 123 | 0
  7 |  11 | dddddddd                         | abc | 123 | 0
 10 |  11 | dddddddd                         | abc | 123 | 0
 15 |  33 | dddddddd                         | abc | 123 | 0
 22 |  77 | dddddddd                         | abc | 123 | 0
 29 | 222 | dddddddd                         | abc | 123 | 2
(27 rows)

create schema scm3;
alter table t11 set schema scm3;
insert into scm3.t11(bb) values(333),(334),(335),(336),(337),(338),(339),(340),(341),(342),(343),(344),(345);
select*from scm3.t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
  1 |  11 | dddddddd                         | abc | 123 |  0
 12 |  33 | dddddddd                         | abc | 123 |  0
 14 |  22 | dddddddd                         | abc | 123 |  0
 16 |  44 | dddddddd                         | abc | 123 |  0
 17 |  44 | dddddddd                         | abc | 123 |  0
 26 |  88 | dddddddd                         | abc | 123 |  0
 28 |     | dddddddd                         | abc | 333 |  1
 30 | 333 | dddddddd                         | abc | 123 |  3
 32 | 335 | dddddddd                         | abc | 123 |  5
 34 | 337 | dddddddd                         | abc | 123 |  7
  3 |  33 | dddddddd                         | abc | 123 |  0
  5 |  22 | dddddddd                         | abc | 123 |  0
  8 |  22 | dddddddd                         | abc | 123 |  0
  9 |  33 | dddddddd                         | abc | 123 |  0
 11 |  22 | dddddddd                         | abc | 123 |  0
 19 |  66 | dddddddd                         | abc | 123 |  0
 20 |  66 | dddddddd                         | abc | 123 |  0
 21 |  66 | dddddddd                         | abc | 123 |  0
 31 | 334 | dddddddd                         | abc | 123 |  4
 35 | 338 | dddddddd                         | abc | 123 |  8
 36 | 339 | dddddddd                         | abc | 123 |  9
 37 | 340 | dddddddd                         | abc | 123 | 10
 38 | 341 | dddddddd                         | abc | 123 | 11
 41 | 344 | dddddddd                         | abc | 123 | 14
  2 |  22 | dddddddd                         | abc | 123 |  0
 13 |  11 | dddddddd                         | abc | 123 |  0
 18 |  55 | dddddddd                         | abc | 123 |  0
 25 |  77 | dddddddd                         | abc | 123 |  0
 27 |  99 | dddddddd                         | abc | 123 |  0
 39 | 342 | dddddddd                         | abc | 123 | 12
 42 | 345 | dddddddd                         | abc | 123 | 15
  4 |  11 | dddddddd                         | abc | 123 |  0
  6 |  33 | dddddddd                         | abc | 123 |  0
  7 |  11 | dddddddd                         | abc | 123 |  0
 10 |  11 | dddddddd                         | abc | 123 |  0
 15 |  33 | dddddddd                         | abc | 123 |  0
 22 |  77 | dddddddd                         | abc | 123 |  0
 29 | 222 | dddddddd                         | abc | 123 |  2
 33 | 336 | dddddddd                         | abc | 123 |  6
 40 | 343 | dddddddd                         | abc | 123 | 13
(40 rows)

update scm3.t11 set ff=ff+1 where bb > 10;
select*from scm3.t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
  1 |  11 | dddddddd                         | abc | 124 |  0
 12 |  33 | dddddddd                         | abc | 124 |  0
 14 |  22 | dddddddd                         | abc | 124 |  0
 16 |  44 | dddddddd                         | abc | 124 |  0
 17 |  44 | dddddddd                         | abc | 124 |  0
 26 |  88 | dddddddd                         | abc | 124 |  0
 28 |     | dddddddd                         | abc | 333 |  1
 30 | 333 | dddddddd                         | abc | 124 |  3
 32 | 335 | dddddddd                         | abc | 124 |  5
 34 | 337 | dddddddd                         | abc | 124 |  7
  3 |  33 | dddddddd                         | abc | 124 |  0
  5 |  22 | dddddddd                         | abc | 124 |  0
  8 |  22 | dddddddd                         | abc | 124 |  0
  9 |  33 | dddddddd                         | abc | 124 |  0
 11 |  22 | dddddddd                         | abc | 124 |  0
 19 |  66 | dddddddd                         | abc | 124 |  0
 20 |  66 | dddddddd                         | abc | 124 |  0
 21 |  66 | dddddddd                         | abc | 124 |  0
 31 | 334 | dddddddd                         | abc | 124 |  4
 35 | 338 | dddddddd                         | abc | 124 |  8
 36 | 339 | dddddddd                         | abc | 124 |  9
 37 | 340 | dddddddd                         | abc | 124 | 10
 38 | 341 | dddddddd                         | abc | 124 | 11
 41 | 344 | dddddddd                         | abc | 124 | 14
  2 |  22 | dddddddd                         | abc | 124 |  0
 13 |  11 | dddddddd                         | abc | 124 |  0
 18 |  55 | dddddddd                         | abc | 124 |  0
 25 |  77 | dddddddd                         | abc | 124 |  0
 27 |  99 | dddddddd                         | abc | 124 |  0
 39 | 342 | dddddddd                         | abc | 124 | 12
 42 | 345 | dddddddd                         | abc | 124 | 15
  4 |  11 | dddddddd                         | abc | 124 |  0
  6 |  33 | dddddddd                         | abc | 124 |  0
  7 |  11 | dddddddd                         | abc | 124 |  0
 10 |  11 | dddddddd                         | abc | 124 |  0
 15 |  33 | dddddddd                         | abc | 124 |  0
 22 |  77 | dddddddd                         | abc | 124 |  0
 29 | 222 | dddddddd                         | abc | 124 |  2
 33 | 336 | dddddddd                         | abc | 124 |  6
 40 | 343 | dddddddd                         | abc | 124 | 13
(40 rows)

delete from scm3.t11 where bb < 10;
select*from scm3.t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
  1 |  11 | dddddddd                         | abc | 124 |  0
 12 |  33 | dddddddd                         | abc | 124 |  0
 14 |  22 | dddddddd                         | abc | 124 |  0
 16 |  44 | dddddddd                         | abc | 124 |  0
 17 |  44 | dddddddd                         | abc | 124 |  0
 26 |  88 | dddddddd                         | abc | 124 |  0
 28 |     | dddddddd                         | abc | 333 |  1
 30 | 333 | dddddddd                         | abc | 124 |  3
 32 | 335 | dddddddd                         | abc | 124 |  5
 34 | 337 | dddddddd                         | abc | 124 |  7
  3 |  33 | dddddddd                         | abc | 124 |  0
  5 |  22 | dddddddd                         | abc | 124 |  0
  8 |  22 | dddddddd                         | abc | 124 |  0
  9 |  33 | dddddddd                         | abc | 124 |  0
 11 |  22 | dddddddd                         | abc | 124 |  0
 19 |  66 | dddddddd                         | abc | 124 |  0
 20 |  66 | dddddddd                         | abc | 124 |  0
 21 |  66 | dddddddd                         | abc | 124 |  0
 31 | 334 | dddddddd                         | abc | 124 |  4
 35 | 338 | dddddddd                         | abc | 124 |  8
 36 | 339 | dddddddd                         | abc | 124 |  9
 37 | 340 | dddddddd                         | abc | 124 | 10
 38 | 341 | dddddddd                         | abc | 124 | 11
 41 | 344 | dddddddd                         | abc | 124 | 14
  2 |  22 | dddddddd                         | abc | 124 |  0
 13 |  11 | dddddddd                         | abc | 124 |  0
 18 |  55 | dddddddd                         | abc | 124 |  0
 25 |  77 | dddddddd                         | abc | 124 |  0
 27 |  99 | dddddddd                         | abc | 124 |  0
 39 | 342 | dddddddd                         | abc | 124 | 12
 42 | 345 | dddddddd                         | abc | 124 | 15
  4 |  11 | dddddddd                         | abc | 124 |  0
  6 |  33 | dddddddd                         | abc | 124 |  0
  7 |  11 | dddddddd                         | abc | 124 |  0
 10 |  11 | dddddddd                         | abc | 124 |  0
 15 |  33 | dddddddd                         | abc | 124 |  0
 22 |  77 | dddddddd                         | abc | 124 |  0
 29 | 222 | dddddddd                         | abc | 124 |  2
 33 | 336 | dddddddd                         | abc | 124 |  6
 40 | 343 | dddddddd                         | abc | 124 | 13
(40 rows)

create table t11 (like scm3.t11 including all);
select*from t11;
 aa | bb | dd | e | ff | g 
----+----+----+---+----+---
(0 rows)

insert into t11(bb) values(333),(334),(335),(336),(337),(338),(339),(340),(341),(342),(343),(344),(345);
select*from t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
 43 | 333 | dddddddd                         | abc | 123 | 16
 44 | 334 | dddddddd                         | abc | 123 | 17
 45 | 335 | dddddddd                         | abc | 123 | 18
 46 | 336 | dddddddd                         | abc | 123 | 19
 47 | 337 | dddddddd                         | abc | 123 | 20
 48 | 338 | dddddddd                         | abc | 123 | 21
 49 | 339 | dddddddd                         | abc | 123 | 22
 50 | 340 | dddddddd                         | abc | 123 | 23
 51 | 341 | dddddddd                         | abc | 123 | 24
 52 | 342 | dddddddd                         | abc | 123 | 25
 53 | 343 | dddddddd                         | abc | 123 | 26
 54 | 344 | dddddddd                         | abc | 123 | 27
 55 | 345 | dddddddd                         | abc | 123 | 28
(13 rows)

update t11 set ff=ff+1 where bb > 10;
select*from t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
 43 | 333 | dddddddd                         | abc | 124 | 16
 44 | 334 | dddddddd                         | abc | 124 | 17
 45 | 335 | dddddddd                         | abc | 124 | 18
 46 | 336 | dddddddd                         | abc | 124 | 19
 47 | 337 | dddddddd                         | abc | 124 | 20
 48 | 338 | dddddddd                         | abc | 124 | 21
 49 | 339 | dddddddd                         | abc | 124 | 22
 50 | 340 | dddddddd                         | abc | 124 | 23
 51 | 341 | dddddddd                         | abc | 124 | 24
 52 | 342 | dddddddd                         | abc | 124 | 25
 53 | 343 | dddddddd                         | abc | 124 | 26
 54 | 344 | dddddddd                         | abc | 124 | 27
 55 | 345 | dddddddd                         | abc | 124 | 28
(13 rows)

delete from t11 where bb < 10;
select*from t11;
 aa | bb  |                dd                |  e  | ff  | g  
----+-----+----------------------------------+-----+-----+----
 43 | 333 | dddddddd                         | abc | 124 | 16
 44 | 334 | dddddddd                         | abc | 124 | 17
 45 | 335 | dddddddd                         | abc | 124 | 18
 46 | 336 | dddddddd                         | abc | 124 | 19
 47 | 337 | dddddddd                         | abc | 124 | 20
 48 | 338 | dddddddd                         | abc | 124 | 21
 49 | 339 | dddddddd                         | abc | 124 | 22
 50 | 340 | dddddddd                         | abc | 124 | 23
 51 | 341 | dddddddd                         | abc | 124 | 24
 52 | 342 | dddddddd                         | abc | 124 | 25
 53 | 343 | dddddddd                         | abc | 124 | 26
 54 | 344 | dddddddd                         | abc | 124 | 27
 55 | 345 | dddddddd                         | abc | 124 | 28
(13 rows)

create table t30(a serial , b int unique not null default 3, primary key(a,b)) partition by range(b);
create table t301 partition of t30 for values from (0) to (10000);
create table t302 partition of t30 for values from (10000) to (20000);
create table t303 partition of t30 for values from (20000) to (30000);
create table t304 partition of t30 for values from (30000) to (40000);
-- it's impossible to require c to be unique because that would require partition keys.
alter table t30 add column c serial;
insert into t30 (b) values(11),(12),(13),(14),(15);
insert into t30 (b) values(14000),(14001),(14002),(14003),(14004);
insert into t30 (b) values(25000),(25001),(25002),(25003),(25004);
insert into t30 (b) values(36000),(36001),(36002),(36003),(36004);
select*from t30;
 a  |   b   | c  
----+-------+----
  1 |    11 |  1
  2 |    12 |  2
  3 |    13 |  3
  4 |    14 |  4
  5 |    15 |  5
  6 | 14000 |  6
  7 | 14001 |  7
  8 | 14002 |  8
  9 | 14003 |  9
 10 | 14004 | 10
 11 | 25000 | 11
 12 | 25001 | 12
 13 | 25002 | 13
 14 | 25003 | 14
 15 | 25004 | 15
 16 | 36000 | 16
 17 | 36001 | 17
 18 | 36002 | 18
 19 | 36003 | 19
 20 | 36004 | 20
(20 rows)

-- when there are rows, can't demand uniqueness for the target column even the
-- column is nullable because mysql will add 0 as 'default default value' when
-- no default value specified.
alter table t30 add column d serial;
select*from t30;
 a  |   b   | c  | d 
----+-------+----+---
  1 |    11 |  1 | 0
  2 |    12 |  2 | 0
  3 |    13 |  3 | 0
  4 |    14 |  4 | 0
  5 |    15 |  5 | 0
  6 | 14000 |  6 | 0
  7 | 14001 |  7 | 0
  8 | 14002 |  8 | 0
  9 | 14003 |  9 | 0
 10 | 14004 | 10 | 0
 11 | 25000 | 11 | 0
 12 | 25001 | 12 | 0
 13 | 25002 | 13 | 0
 14 | 25003 | 14 | 0
 15 | 25004 | 15 | 0
 16 | 36000 | 16 | 0
 17 | 36001 | 17 | 0
 18 | 36002 | 18 | 0
 19 | 36003 | 19 | 0
 20 | 36004 | 20 | 0
(20 rows)

alter table t30 rename a to aa;
alter table t30 rename b to bb;
alter table t30 rename c to cc;
alter table t30 add column e int not null;
alter table t30 add column f int;
alter table t30 alter column bb drop default, alter column bb add generated by default as identity(start 100);
\d+ t30;
                                                Table "public.t30"
 Column |  Type   | Collation | Nullable |             Default              | Storage | Stats target | Description 
--------+---------+-----------+----------+----------------------------------+---------+--------------+-------------
 aa     | integer |           | not null | "nextval"('t30_a_seq'::regclass) | plain   |              | 
 bb     | integer |           | not null | generated by default as identity | plain   |              | 
 cc     | integer |           | not null | "nextval"('t30_c_seq'::regclass) | plain   |              | 
 d      | integer |           | not null | "nextval"('t30_d_seq'::regclass) | plain   |              | 
 e      | integer |           | not null |                                  | plain   |              | 
 f      | integer |           |          |                                  | plain   |              | 
Partition key: RANGE (bb)
Indexes:
    "t30_pkey" PRIMARY KEY, btree (aa, bb)
    "t30_b_key" UNIQUE CONSTRAINT, btree (bb)
Partitions: t301 FOR VALUES FROM (0) TO (10000),
            t302 FOR VALUES FROM (10000) TO (20000),
            t303 FOR VALUES FROM (20000) TO (30000),
            t304 FOR VALUES FROM (30000) TO (40000)

insert into t30(e) values(1111),(1111),(1111),(1111);
update t30 set f=2222;
select*from t30;
 aa |  bb   | cc | d |  e   |  f   
----+-------+----+---+------+------
  1 |    11 |  1 | 0 |    0 | 2222
  2 |    12 |  2 | 0 |    0 | 2222
  3 |    13 |  3 | 0 |    0 | 2222
  4 |    14 |  4 | 0 |    0 | 2222
  5 |    15 |  5 | 0 |    0 | 2222
 21 |   100 | 21 | 1 | 1111 | 2222
 22 |   101 | 22 | 2 | 1111 | 2222
 23 |   102 | 23 | 3 | 1111 | 2222
 24 |   103 | 24 | 4 | 1111 | 2222
  6 | 14000 |  6 | 0 |    0 | 2222
  7 | 14001 |  7 | 0 |    0 | 2222
  8 | 14002 |  8 | 0 |    0 | 2222
  9 | 14003 |  9 | 0 |    0 | 2222
 10 | 14004 | 10 | 0 |    0 | 2222
 11 | 25000 | 11 | 0 |    0 | 2222
 12 | 25001 | 12 | 0 |    0 | 2222
 13 | 25002 | 13 | 0 |    0 | 2222
 14 | 25003 | 14 | 0 |    0 | 2222
 15 | 25004 | 15 | 0 |    0 | 2222
 16 | 36000 | 16 | 0 |    0 | 2222
 17 | 36001 | 17 | 0 |    0 | 2222
 18 | 36002 | 18 | 0 |    0 | 2222
 19 | 36003 | 19 | 0 |    0 | 2222
 20 | 36004 | 20 | 0 |    0 | 2222
(24 rows)

alter table t30 alter column e add generated by default as identity, alter column f set not null, alter column f add generated by default as identity, alter bb drop identity;
\d+ t30;
                                                Table "public.t30"
 Column |  Type   | Collation | Nullable |             Default              | Storage | Stats target | Description 
--------+---------+-----------+----------+----------------------------------+---------+--------------+-------------
 aa     | integer |           | not null | "nextval"('t30_a_seq'::regclass) | plain   |              | 
 bb     | integer |           | not null |                                  | plain   |              | 
 cc     | integer |           | not null | "nextval"('t30_c_seq'::regclass) | plain   |              | 
 d      | integer |           | not null | "nextval"('t30_d_seq'::regclass) | plain   |              | 
 e      | integer |           | not null | generated by default as identity | plain   |              | 
 f      | integer |           | not null | generated by default as identity | plain   |              | 
Partition key: RANGE (bb)
Indexes:
    "t30_pkey" PRIMARY KEY, btree (aa, bb)
    "t30_b_key" UNIQUE CONSTRAINT, btree (bb)
Partitions: t301 FOR VALUES FROM (0) TO (10000),
            t302 FOR VALUES FROM (10000) TO (20000),
            t303 FOR VALUES FROM (20000) TO (30000),
            t304 FOR VALUES FROM (30000) TO (40000)

insert into t30(bb) values(200),(201),(202),(203);
select*from t30;
 aa |  bb   | cc | d |  e   |  f   
----+-------+----+---+------+------
  1 |    11 |  1 | 0 |    0 | 2222
  2 |    12 |  2 | 0 |    0 | 2222
  3 |    13 |  3 | 0 |    0 | 2222
  4 |    14 |  4 | 0 |    0 | 2222
  5 |    15 |  5 | 0 |    0 | 2222
 21 |   100 | 21 | 1 | 1111 | 2222
 22 |   101 | 22 | 2 | 1111 | 2222
 23 |   102 | 23 | 3 | 1111 | 2222
 24 |   103 | 24 | 4 | 1111 | 2222
 25 |   200 | 25 | 5 |    1 |    1
 26 |   201 | 26 | 6 |    2 |    2
 27 |   202 | 27 | 7 |    3 |    3
 28 |   203 | 28 | 8 |    4 |    4
  6 | 14000 |  6 | 0 |    0 | 2222
  7 | 14001 |  7 | 0 |    0 | 2222
  8 | 14002 |  8 | 0 |    0 | 2222
  9 | 14003 |  9 | 0 |    0 | 2222
 10 | 14004 | 10 | 0 |    0 | 2222
 11 | 25000 | 11 | 0 |    0 | 2222
 12 | 25001 | 12 | 0 |    0 | 2222
 13 | 25002 | 13 | 0 |    0 | 2222
 14 | 25003 | 14 | 0 |    0 | 2222
 15 | 25004 | 15 | 0 |    0 | 2222
 16 | 36000 | 16 | 0 |    0 | 2222
 17 | 36001 | 17 | 0 |    0 | 2222
 18 | 36002 | 18 | 0 |    0 | 2222
 19 | 36003 | 19 | 0 |    0 | 2222
 20 | 36004 | 20 | 0 |    0 | 2222
(28 rows)

--alter table t30 alter column e set start 1000;
create table t31 (like t30 including all) partition by hash(bb);
create table t310 partition of t31 for values with (modulus 4, remainder 0);
create table t311 partition of t31 for values with (modulus 4, remainder 1);
create table t312 partition of t31 for values with (modulus 4, remainder 2);
create table t313 partition of t31 for values with (modulus 4, remainder 3);
\d+ t31;
                                                Table "public.t31"
 Column |  Type   | Collation | Nullable |             Default              | Storage | Stats target | Description 
--------+---------+-----------+----------+----------------------------------+---------+--------------+-------------
 aa     | integer |           | not null | "nextval"('t30_a_seq'::regclass) | plain   |              | 
 bb     | integer |           | not null |                                  | plain   |              | 
 cc     | integer |           | not null | "nextval"('t30_c_seq'::regclass) | plain   |              | 
 d      | integer |           | not null | "nextval"('t30_d_seq'::regclass) | plain   |              | 
 e      | integer |           | not null | generated by default as identity | plain   |              | 
 f      | integer |           | not null | generated by default as identity | plain   |              | 
Partition key: HASH (bb)
Indexes:
    "t31_pkey" PRIMARY KEY, btree (aa, bb)
    "t31_bb_key" UNIQUE CONSTRAINT, btree (bb)
Partitions: t310 FOR VALUES WITH (modulus 4, remainder 0),
            t311 FOR VALUES WITH (modulus 4, remainder 1),
            t312 FOR VALUES WITH (modulus 4, remainder 2),
            t313 FOR VALUES WITH (modulus 4, remainder 3)

insert into t31 (bb) values(1),(2),(3),(4),(5),(10004),(10005),(10006),(20007),(20008),(30009);
select*from t31;
 aa |  bb   | cc | d  | e  | f  
----+-------+----+----+----+----
 29 |     1 | 29 |  9 |  1 |  1
 31 |     3 | 31 | 11 |  3 |  3
 33 |     5 | 33 | 13 |  5 |  5
 39 | 30009 | 39 | 19 | 11 | 11
 30 |     2 | 30 | 10 |  2 |  2
 35 | 10005 | 35 | 15 |  7 |  7
 38 | 20008 | 38 | 18 | 10 | 10
 32 |     4 | 32 | 12 |  4 |  4
 34 | 10004 | 34 | 14 |  6 |  6
 36 | 10006 | 36 | 16 |  8 |  8
 37 | 20007 | 37 | 17 |  9 |  9
(11 rows)

update t31 set bb=bb-1 where bb < 30000;
ERROR:  Can not update partition key of a remote relation.
select*from t31;
 aa |  bb   | cc | d  | e  | f  
----+-------+----+----+----+----
 29 |     1 | 29 |  9 |  1 |  1
 31 |     3 | 31 | 11 |  3 |  3
 33 |     5 | 33 | 13 |  5 |  5
 39 | 30009 | 39 | 19 | 11 | 11
 30 |     2 | 30 | 10 |  2 |  2
 35 | 10005 | 35 | 15 |  7 |  7
 38 | 20008 | 38 | 18 | 10 | 10
 32 |     4 | 32 | 12 |  4 |  4
 34 | 10004 | 34 | 14 |  6 |  6
 36 | 10006 | 36 | 16 |  8 |  8
 37 | 20007 | 37 | 17 |  9 |  9
(11 rows)

delete from t31 where cc > 18000;
select*from t31;
 aa |  bb   | cc | d  | e  | f  
----+-------+----+----+----+----
 29 |     1 | 29 |  9 |  1 |  1
 31 |     3 | 31 | 11 |  3 |  3
 33 |     5 | 33 | 13 |  5 |  5
 39 | 30009 | 39 | 19 | 11 | 11
 30 |     2 | 30 | 10 |  2 |  2
 35 | 10005 | 35 | 15 |  7 |  7
 38 | 20008 | 38 | 18 | 10 | 10
 32 |     4 | 32 | 12 |  4 |  4
 34 | 10004 | 34 | 14 |  6 |  6
 36 | 10006 | 36 | 16 |  8 |  8
 37 | 20007 | 37 | 17 |  9 |  9
(11 rows)

drop table t11;
drop table t31;
drop table t30;
drop table scm3.t11;
drop schema scm3 cascade;
